<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CellBlock RP — QCM WL (40 Questions)</title>
<style>
:root {
  --bg-dark: #0b0d10;
  --bg-card: #14171c;
  --orange: #ff7a00;
  --steel: #9ea3a8;
  --text: #e8edf2;
  --accent: #ff7a00;
}
body {
  margin:0;
  font-family: system-ui, sans-serif;
  background: linear-gradient(160deg, #0b0d10, #1a1e24);
  color: var(--text);
  display:flex;
  justify-content:center;
  padding:20px;
}
.card {
  background: var(--bg-card);
  border-radius: 16px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.5);
  padding:20px;
  max-width: 900px;
  width:100%;
}
h1 {
  text-align:center;
  color: var(--accent);
  margin:0 0 10px 0;
}
.progress {
  background: #222;
  border-radius: 10px;
  overflow: hidden;
  height: 12px;
  margin-bottom: 10px;
}
.progress-bar {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), #ff9f40);
  width: 0%;
  transition: width 0.3s ease;
}
.question {
  background: rgba(255,255,255,0.02);
  border: 1px solid rgba(255,255,255,0.08);
  padding:15px;
  border-radius: 10px;
  margin-bottom: 15px;
}
.choices label {
  display:block;
  padding:10px;
  margin:5px 0;
  background: #1c1f24;
  border-radius: 8px;
  cursor:pointer;
  border: 1px solid transparent;
}
.choices label:hover {
  border-color: var(--accent);
}
.row {
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:15px;
}
.row input {
  flex:1 1 200px;
  padding:10px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.1);
  background:#0f1216;
  color:var(--text);
}
button {
  background: var(--accent);
  color:white;
  padding:12px 16px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
}
.toast {
  position:fixed;
  bottom:20px;
  right:20px;
  background:#10161f;
  padding:12px 14px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.1);
  display:none;
}
</style>
</head>
<body>
<div class="card">
  <h1>CellBlock RP — QCM WL</h1>
  <div class="progress"><div class="progress-bar" id="progress-bar"></div></div>
  <p id="progress-text">Question 1 / 40</p>
  <form id="qcm-form"></form>
  <div class="row">
    <input id="discordId" placeholder="Ton ID Discord" required />
    <input id="username" placeholder="Ton pseudo Discord" />
  </div>
  <button type="button" id="submitBtn">Envoyer mes réponses</button>
</div>
<div id="toast" class="toast"></div>

<script>
const QCM_SECRET = "jojo2002";
const API_ENDPOINT = "/notify-qcm";
const questions = [
  {q:"Le metagaming est-il autorisé ?",choices:["Oui","Non","Uniquement en groupe","Si c'est drôle"],correct:1},
  {q:"En RP, que signifie 'Fear RP' ?",choices:["Craindre pour sa vie","Ne jamais fuir","Tirer immédiatement","Ignorer la menace"],correct:0},
  {q:"Peut-on utiliser des infos obtenues hors RP en jeu ?",choices:["Oui","Non","Uniquement avec accord admin","Seulement en urgence"],correct:1},
  // ... ajoute 37 autres questions ici
];
while(questions.length<40){
  questions.push({q:`Question ${questions.length+1}`,choices:["Réponse A","Réponse B","Réponse C","Réponse D"],correct:0});
}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
const shuffledQ = shuffle([...questions]);
const form = document.getElementById("qcm-form");
shuffledQ.forEach((q,i)=>{
  const qDiv = document.createElement("div");
  qDiv.className="question";
  const shuffledChoices = shuffle(q.choices.map((c,idx)=>({text:c,index:idx})));
  qDiv.innerHTML = `<h3>${i+1}. ${q.q}</h3>
    <div class="choices">
      ${shuffledChoices.map(ch=>`
      <label>
        <input type="radio" name="q${i}" value="${ch.index}" required> ${ch.text}
      </label>`).join("")}
    </div>`;
  form.appendChild(qDiv);
});
const toast = document.getElementById("toast");
function showToast(msg){
  toast.innerText=msg;
  toast.style.display="block";
  setTimeout(()=>toast.style.display="none",4000);
}
document.getElementById("submitBtn").addEventListener("click",async()=>{
  const discordId = document.getElementById("discordId").value.trim();
  const username = document.getElementById("username").value.trim();
  if(!discordId){showToast("❌ ID Discord requis");return;}
  let score=0;
  shuffledQ.forEach((q,i)=>{
    const ans = document.querySelector(`input[name="q${i}"]:checked`);
    if(ans && Number(ans.value)===q.correct) score++;
  });
  try{
    const res=await fetch(API_ENDPOINT,{
      method:"POST",
      headers:{"Content-Type":"application/json","x-qcm-secret":QCM_SECRET},
      body:JSON.stringify({discordId,username,score,total:shuffledQ.length})
    });
    if(!res.ok) throw new Error("Erreur serveur");
    new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_d0532919c3.mp3").play();
    showToast(`✅ Envoyé ! Score: ${score}/${shuffledQ.length}`);
  }catch(e){
    showToast("❌ Envoi impossible");
  }
});
</script>
</body>
</html>
